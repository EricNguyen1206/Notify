"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[838],{715:(e,t,n)=>{n.d(t,{I:()=>m,SQ:()=>f,_2:()=>v,lp:()=>p,mB:()=>C,rI:()=>c,ty:()=>u});var o=n(9611),a=n(8011),r=n(1438),s=n(390),i=n(7318),d=n(1994),l=n(6245);let c=r.bL,u=r.l9,m=r.YJ;r.ZL,r.Pb,r.z6,a.forwardRef((e,t)=>{let{className:n,inset:a,children:i,...d}=e;return(0,o.jsxs)(r.ZP,{ref:t,className:(0,l.cn)("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",n),...d,children:[i,(0,o.jsx)(s.A,{className:"ml-auto"})]})}).displayName=r.ZP.displayName,a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)(r.G5,{ref:t,className:(0,l.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",n),...a})}).displayName=r.G5.displayName;let f=a.forwardRef((e,t)=>{let{className:n,sideOffset:a=4,...s}=e;return(0,o.jsx)(r.ZL,{children:(0,o.jsx)(r.UC,{ref:t,sideOffset:a,className:(0,l.cn)("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",n),...s})})});f.displayName=r.UC.displayName;let v=a.forwardRef((e,t)=>{let{className:n,inset:a,...s}=e;return(0,o.jsx)(r.q7,{ref:t,className:(0,l.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",a&&"pl-8",n),...s})});v.displayName=r.q7.displayName,a.forwardRef((e,t)=>{let{className:n,children:a,checked:s,...d}=e;return(0,o.jsxs)(r.H_,{ref:t,checked:null!=s&&s,className:(0,l.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...d,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(r.VF,{children:(0,o.jsx)(i.A,{className:"h-4 w-4"})})}),a]})}).displayName=r.H_.displayName,a.forwardRef((e,t)=>{let{className:n,children:a,...s}=e;return(0,o.jsxs)(r.hN,{ref:t,className:(0,l.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...s,children:[(0,o.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,o.jsx)(r.VF,{children:(0,o.jsx)(d.A,{className:"h-2 w-2 fill-current"})})}),a]})}).displayName=r.hN.displayName;let p=a.forwardRef((e,t)=>{let{className:n,inset:a,...s}=e;return(0,o.jsx)(r.JU,{ref:t,className:(0,l.cn)("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",n),...s})});p.displayName=r.JU.displayName;let C=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)(r.wv,{ref:t,className:(0,l.cn)("-mx-1 my-1 h-px bg-muted",n),...a})});C.displayName=r.wv.displayName},920:(e,t,n)=>{n.d(t,{d2:()=>u,m8:()=>c,sg:()=>l});var o=n(346),a=n(8527),r=n(8914);let s=async()=>{let{data:e}=await r.u.get("/users/profile");return e.data},i=async e=>{let{data:t}=await r.u.get("/users/search",{params:{username:e}});return t},d=async e=>{let{data:t}=await r.u.put("/users/profile",e);return t.data},l=e=>(0,o.I)({queryKey:["user","current"],queryFn:s,staleTime:3e5,retry:(e,t)=>{var n;return(null==(n=t.response)?void 0:n.status)!==401&&e<2},...e}),c=e=>(0,o.I)({queryKey:["users","search",e],queryFn:()=>i(e),enabled:!!e&&e.length>=2,staleTime:3e4}),u=e=>(0,a.n)({mutationKey:["users","profile","update"],mutationFn:d,...e})},1762:(e,t,n)=>{n.d(t,{Cf:()=>f,Es:()=>p,HM:()=>u,L3:()=>C,c7:()=>v,lG:()=>d,zM:()=>l});var o=n(9611),a=n(3644),r=n(9622),s=n(8011),i=n(6245);let d=a.bL,l=a.l9,c=a.ZL,u=a.bm,m=s.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(a.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...r})});m.displayName=a.hJ.displayName;let f=s.forwardRef((e,t)=>{let{className:n,children:s,...d}=e;return(0,o.jsxs)(c,{children:[(0,o.jsx)(m,{}),(0,o.jsxs)(a.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...d,children:[s,(0,o.jsxs)(a.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,o.jsx)(r.A,{className:"h-4 w-4"}),(0,o.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=a.UC.displayName;let v=e=>{let{className:t,...n}=e;return(0,o.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})};v.displayName="DialogHeader";let p=e=>{let{className:t,...n}=e;return(0,o.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};p.displayName="DialogFooter";let C=s.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(a.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",n),...r})});C.displayName=a.hE.displayName,s.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,o.jsx)(a.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",n),...r})}).displayName=a.VY.displayName},2039:(e,t,n)=>{n.d(t,{w:()=>o});let o=(0,n(875).v)((e,t)=>({unreadCounts:{},activeConversationId:null,currentConversation:null,groupConversations:[],directConversations:[],currentConversationId:null,joinedConversations:new Set,setUnreadCount:(t,n)=>e(e=>({unreadCounts:{...e.unreadCounts,[t]:n}})),setActiveConversation:t=>e({activeConversationId:t}),setCurrentConversation:t=>e({currentConversation:t}),markAsRead:t=>e(e=>({unreadCounts:{...e.unreadCounts,[t]:0}})),setGroupConversations:t=>e({groupConversations:t}),setDirectConversations:t=>e({directConversations:t}),addGroupConversation:t=>e(e=>({groupConversations:[...e.groupConversations,t]})),addDirectConversation:t=>e(e=>({directConversations:[...e.directConversations,t]})),removeConversation:(t,n)=>e(e=>({groupConversations:"group"===n?e.groupConversations.filter(e=>e.id!==t):e.groupConversations,directConversations:"direct"===n?e.directConversations.filter(e=>e.id!==t):e.directConversations})),setCurrentConversationId:t=>{e({currentConversationId:t})},addJoinedConversation:t=>{e(e=>{let n=new Set(e.joinedConversations);return n.add(t),{joinedConversations:n}})},removeJoinedConversation:t=>{e(e=>{let n=new Set(e.joinedConversations);return n.delete(t),{joinedConversations:n,currentConversationId:e.currentConversationId===t?null:e.currentConversationId}})},clearJoinedConversations:()=>{e({joinedConversations:new Set,currentConversationId:null})},getCurrentConversationId:()=>t().currentConversationId,isInConversation:e=>t().joinedConversations.has(e),getJoinedConversations:()=>Array.from(t().joinedConversations),isCurrentConversation:e=>t().currentConversationId===e}))},2541:(e,t,n)=>{n.d(t,{KN:()=>i.ConnectionState,Us:()=>d});var o=n(875),a=n(120),r=n(7832),s=n(2039),i=n(6383);let d=(0,o.v)()((0,a.lt)((e,t)=>({connectionState:i.ConnectionState.DISCONNECTED,error:null,isConnecting:!1,socket:null,userId:"",username:"",url:"",connect:async(n,o)=>{let{socket:a,connectionState:d}=t();if(d===i.ConnectionState.CONNECTING)throw Error("Connection already in progress");if(d!==i.ConnectionState.CONNECTED||null==a||!a.connected){a&&a.disconnect();try{var l;e({connectionState:i.ConnectionState.CONNECTING,error:null,isConnecting:!0,userId:n});let a=(l="http://localhost:8080/api/v1",void 0!==l)?l:"http://localhost:8080";return e({url:a}),new Promise((n,d)=>{let l=(0,r.io)(a,{transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:3e3,timeout:1e4,auth:{token:o}});e({socket:l}),l.on(i.SocketEvent.CONNECT,()=>{console.log("Socket.IO connected and authenticated successfully"),e({connectionState:i.ConnectionState.CONNECTED,isConnecting:!1}),t().setupEventHandlers();try{let e=s.w.getState().getJoinedConversations();e.length>0&&(console.log("Re-joining conversations:",e),e.forEach(e=>{t().joinConversation(e)}))}catch(e){console.error("Auto re-join conversations failed:",e)}n()}),l.on(i.SocketEvent.CONNECTION_ERROR,t=>{console.error("Socket.IO connection error:",t),e({connectionState:i.ConnectionState.ERROR,error:t.message||"Connection failed",isConnecting:!1}),d(t)}),l.on(i.SocketEvent.DISCONNECT,t=>{console.log("Socket.IO disconnected:",t),e({connectionState:i.ConnectionState.DISCONNECTED,isConnecting:!1})}),l.on(i.SocketEvent.ERROR,t=>{console.error("Socket.IO error:",t),e({error:t.message}),("AUTH_FAILED"===t.code||"AUTH_ERROR"===t.code)&&(e({connectionState:i.ConnectionState.ERROR,isConnecting:!1}),d(Error(t.message)))}),setTimeout(()=>{if(t().connectionState===i.ConnectionState.CONNECTING){l.disconnect();let t=Error("Connection timeout");e({connectionState:i.ConnectionState.ERROR,error:"Connection timeout",isConnecting:!1}),d(t)}},15e3)})}catch(t){throw e({connectionState:i.ConnectionState.ERROR,error:t instanceof Error?t.message:"Connection failed",isConnecting:!1}),t}}},setupEventHandlers:()=>{let{socket:e}=t();e&&(e.on(i.SocketEvent.NEW_MESSAGE,e=>{console.log("New message received:",e),window.dispatchEvent(new CustomEvent("chat-message",{detail:{message:e,conversationId:e.conversationId}}))}),e.on(i.SocketEvent.JOINED_CONVERSATION,e=>{console.log("Joined conversation:",e),window.dispatchEvent(new CustomEvent("ws-conversation-join-ack",{detail:{conversationId:e.conversation_id,userId:e.user_id}}))}),e.on(i.SocketEvent.LEFT_CONVERSATION,e=>{console.log("Left conversation:",e),window.dispatchEvent(new CustomEvent("ws-conversation-leave-ack",{detail:{conversationId:e.conversation_id,userId:e.user_id}}))}),e.on(i.SocketEvent.USER_JOINED,e=>{console.log("User joined conversation:",e),window.dispatchEvent(new CustomEvent("ws-user-joined",{detail:e}))}),e.on(i.SocketEvent.USER_LEFT,e=>{console.log("User left conversation:",e),window.dispatchEvent(new CustomEvent("ws-user-left",{detail:e}))}))},disconnect:()=>{let{socket:n}=t();n&&n.disconnect(),e({connectionState:i.ConnectionState.DISCONNECTED,error:null,isConnecting:!1,socket:null})},sendMessage:(n,o,a,r)=>{let{socket:s,connectionState:d}=t();if(!s||d!==i.ConnectionState.CONNECTED||!s.connected)throw Error("Socket.IO not connected");try{let e=(0,i.createSendMessagePayload)(parseInt(n),o||null,a||null,r||null);s.emit(i.SocketEvent.SEND_MESSAGE,e)}catch(t){throw e({error:t instanceof Error?t.message:"Failed to send message"}),t}},joinConversation:n=>{let{socket:o,connectionState:a}=t();if(!o||a!==i.ConnectionState.CONNECTED||!o.connected)throw Error("Socket.IO not connected");try{let e=(0,i.createJoinConversationPayload)(parseInt(n));o.emit(i.SocketEvent.JOIN_CONVERSATION,e);try{s.w.getState().addJoinedConversation(n)}catch(e){console.error("Failed to track joined conversation:",e)}}catch(t){throw e({error:t instanceof Error?t.message:"Failed to join conversation"}),t}},leaveConversation:e=>{let{socket:n,connectionState:o}=t();if(n&&o===i.ConnectionState.CONNECTED)try{let t=(0,i.createLeaveConversationPayload)(parseInt(e));n.emit(i.SocketEvent.LEAVE_CONVERSATION,t);try{s.w.getState().removeJoinedConversation(e)}catch(e){console.error("Failed to untrack joined conversation:",e)}}catch(e){console.error("Failed to leave conversation:",e)}},isConnected:()=>{let{socket:e,connectionState:n}=t();return n===i.ConnectionState.CONNECTED&&(null==e?void 0:e.connected)===!0}}),{name:"socket-store"}))},3550:(e,t,n)=>{n.d(t,{p:()=>s});var o=n(9611),a=n(8011),r=n(6245);let s=a.forwardRef((e,t)=>{let{className:n,type:a,...s}=e;return(0,o.jsx)("input",{type:a,className:(0,r.cn)("flex h-10 w-full rounded-chat border border-input bg-transparent px-3 py-2 text-base font-normal shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-chat-primary disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...s})});s.displayName="Input"},4593:(e,t,n)=>{n.d(t,{BK:()=>d,eu:()=>i,q5:()=>l});var o=n(9611),a=n(8011),r=n(8237),s=n(6245);let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)(r.bL,{ref:t,className:(0,s.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...a})});i.displayName=r.bL.displayName;let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)(r._V,{ref:t,className:(0,s.cn)("aspect-square h-full w-full",n),...a})});d.displayName=r._V.displayName;let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)(r.H4,{ref:t,className:(0,s.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...a})});l.displayName=r.H4.displayName},6551:(e,t,n)=>{n.d(t,{Bc:()=>i,ZI:()=>c,k$:()=>l,m_:()=>d});var o=n(9611),a=n(8011),r=n(9376),s=n(6245);let i=r.Kq,d=r.bL,l=r.l9,c=a.forwardRef((e,t)=>{let{className:n,sideOffset:a=4,...i}=e;return(0,o.jsx)(r.ZL,{children:(0,o.jsx)(r.UC,{ref:t,sideOffset:a,className:(0,s.cn)("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",n),...i})})});c.displayName=r.UC.displayName},6619:(e,t,n)=>{n.d(t,{E:()=>r});var o=n(9611),a=n(6245);function r(e){let{className:t,...n}=e;return(0,o.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-chat bg-chat-primary/10",t),...n})}},8518:(e,t,n)=>{n.d(t,{$:()=>l});var o=n(9611),a=n(745),r=n(6428),s=n(8011),i=n(6245);let d=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-chat text-base font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-chat-primary disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-chat-primary text-white shadow hover:bg-chat-secondary",destructive:"bg-chat-error text-white shadow-sm hover:bg-chat-error/90",outline:"border border-chat-border bg-background shadow-sm hover:bg-chat-accent/10 hover:text-chat-primary hover:border-chat-primary",secondary:"bg-chat-secondary text-white shadow-sm hover:bg-chat-secondary/80",ghost:"hover:bg-chat-accent/10 hover:text-chat-primary",link:"text-chat-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-8 rounded-chat px-3 text-sm",lg:"h-12 rounded-chat px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:n,variant:r,size:s,asChild:l=!1,...c}=e,u=l?a.DX:"button";return(0,o.jsx)(u,{className:(0,i.cn)(d({variant:r,size:s,className:n})),ref:t,...c})});l.displayName="Button"},8572:(e,t,n)=>{n.d(t,{CW:()=>v,Hy:()=>C,Pp:()=>f,SW:()=>m,t7:()=>p});var o=n(346),a=n(8527),r=n(8914);let s=["conversations"],i=async()=>{let{data:e}=await r.u.get("/conversations");return e.data},d=async e=>{let{data:t}=await r.u.get("/conversations/".concat(e));return t.data},l=async e=>{let{data:t}=await r.u.post("/conversations",e);return t.data},c=async e=>{let{data:t}=await r.u.delete("/conversations/".concat(e));return t},u=async e=>{let{data:t}=await r.u.put("/conversations/".concat(e,"/user"),{});return t},m=e=>(0,o.I)({queryKey:s,queryFn:i,staleTime:3e4,...e}),f=(e,t)=>(0,o.I)({queryKey:[...s,e],queryFn:()=>d(e),enabled:!!e,...t}),v=e=>(0,a.n)({mutationKey:["conversations","create"],mutationFn:l,...e}),p=e=>(0,a.n)({mutationKey:["conversations","delete"],mutationFn:c,...e}),C=e=>(0,a.n)({mutationKey:["conversations","leave"],mutationFn:u,...e})},8914:(e,t,n)=>{n.d(t,{u:()=>o});let o=n(2159).A.create({baseURL:"http://localhost:8080/api/v1",timeout:1e4,withCredentials:!0}),a=!1,r=[],s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r.forEach(n=>{e?n.reject(e):n.resolve(t)}),r=[]};o.interceptors.request.use(e=>e,e=>{throw console.error("\uD83D\uDEA8 Axios Request Error:",e),e}),o.interceptors.response.use(e=>e,async e=>{var t;let n=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!n._retry){if(a)return new Promise((e,t)=>{r.push({resolve:t=>{n.headers=n.headers||{},e(o(n))},reject:t})});n._retry=!0,a=!0;try{return await o.post("/auth/refresh"),s(null,null),o(n)}catch(e){throw s(e,null),window.location.href="/login",e}finally{a=!1}}throw e})}}]);